!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sureway MeMart Africa Escrow Demo</title>
  <link rel="icon" href="Sureway-logo.png">
  <script src="https://cdn.jsdelivr.net/npm/@stacks/connect@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/@stacks/transactions@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/@stacks/network@latest"></script>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: linear-gradient(180deg, #f4f8ff, #ffffff);
      color: #1b1b1b;
      text-align: center;
      padding: 20px;
    }
    h2 { color: #004aad; }
    button {
      margin: 8px;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      background-color: #004aad;
      color: white;
      font-size: 16px;
      cursor: pointer;
      transition: 0.2s;
    }
    button:hover { background-color: #0073ff; transform: scale(1.05); }
    #feed {
      width: 90%;
      max-width: 700px;
      height: 250px;
      overflow-y: auto;
      background: #0f172a;
      color: #00ff9d;
      text-align: left;
      margin: 20px auto;
      border-radius: 10px;
      padding: 15px;
      font-family: monospace;
    }
    footer {
      margin-top: 40px;
      font-size: 14px;
      color: #444;
      line-height: 1.6;
    }
    pre {
      background: #e9f0ff;
      padding: 10px;
      border-radius: 8px;
      overflow-x: auto;
      text-align: left;
    }
  </style>
</head>
<body>

  <img src="Sureway-logo.png" alt="Sureway Logo" width="100">
  <h2>Sureway MeMart Africa Escrow Demo</h2>
  <p>Blockchain-powered logistics & payment escrow built on <b>Stacks Testnet</b></p>

  <h3>Smart Contract: <code>sureway-escrow.clar</code></h3>
  <pre>
// Sureway Escrow Contract (Clarity)

(define-data-var deposits (map principal uint))

(define-public (deposit (receiver principal) (amount uint))
  (begin
    (map-set deposits {sender: tx-sender} amount)
    (print {action: "deposit", from: tx-sender, to: receiver, amount: amount})
    (ok true)))

(define-public (confirm-delivery)
  (begin
    (print {action: "confirm-delivery", sender: tx-sender})
    (ok true)))

(define-public (refund)
  (begin
    (print {action: "refund", sender: tx-sender})
    (ok true)))
  </pre>

  <h3>Transaction Simulation</h3>
  <p><b>Seller:</b> ST2W71F29DDHZRCAT6FTWQ7N5HA44X6RG1MY8QRSC</p>
  <p><b>Amount:</b> 200 STX</p>
  <p><b>Buyer Wallet:</b> Connect below</p>

  <button id="connectWallet">üîó Connect Leather Wallet</button>
  <button id="deposit">üí∞ Deposit 200 STX</button>
  <button id="confirm">‚úÖ Confirm Delivery</button>
  <button id="refund">‚Ü©Ô∏è Refund</button>

  <h3>üîç Live Blockchain Feed</h3>
  <div id="feed">‚è≥ Waiting for blockchain activity...</div>

  <footer>
    ¬© 2025 Sureway Integrated Technology Solutions Limited RC 8481374<br>
  
  </footer

  <script>
    const { AppConfig, UserSession, showConnect } = window.StacksConnect;
    const { openContractCall } = window.StacksTransactions;
    const { StacksTestnet } = window.StacksNetwork;

    const appConfig = new AppConfig(['store_write', 'publish_data']);
    const userSession = new UserSession({ appConfig });
    const network = new StacksTestnet();

    // After deploying on Hiro Sandbox, replace these:
    const contractAddress = "ST2W71F29DDHZRCAT6FTWQ7N5HA44X6RG1MY8QRSC";
    const contractName = "sureway-escrow";

    const feed = document.getElementById("feed");
    function logFeed(msg) {
      const t = new Date().toLocaleTimeString();
      feed.innerHTML += `\n[${t}] ${msg}`;
      feed.scrollTop = feed.scrollHeight;
    }

    document.getElementById("connectWallet").onclick = () => {
      showConnect({
        userSession,
        appDetails: { name: "Sureway MeMart Africa", icon: "Sureway-logo.png" },
        onFinish: () => logFeed("‚úÖ Wallet connected successfully.")
      });
    };

    async function transact(fnName) {
      if (!userSession.isUserSignedIn()) {
        logFeed("‚ö†Ô∏è Connect your wallet first!");
        return;
      }
      try {
        const txOptions = {
          contractAddress,
          contractName,
          functionName: fnName,
          functionArgs: [],
          network,
          appDetails: { name: "Sureway MeMart Africa" },
          onFinish: data => logFeed(`‚úÖ ${fnName} executed | TxID: ${data.txId}`),
          onCancel: () => logFeed("‚ùå Transaction cancelled.")
        };
        logFeed(`üöÄ Running ${fnName}...`);
        await openContractCall(txOptions);
      } catch (err) {
        logFeed(`‚ùå Error: ${err.message}`);
      }
    }

    document.getElementById("deposit").onclick = () => transact("deposit");
    document.getElementById("confirm").onclick = () => transact("confirm-delivery");
    document.getElementById("refund").onclick = () => transact("refund");
  </script>

</body>
</html>

