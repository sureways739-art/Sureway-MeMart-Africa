!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sureway MeMart Africa Escrow Demo</title>
<link rel="icon" href="Sureway-logo.png">
<script src="https://cdn.jsdelivr.net/npm/@stacks/connect@latest/dist/stacks-connect.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@stacks/transactions@latest/dist/stacks-transactions.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@stacks/network@latest/dist/stacks-network.min.js"></script>
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(180deg, #002244, #0055aa);
    color: #fff;
    margin: 0; padding: 0;
    text-align: center;
  }
  header img {
    width: 90px; margin-top: 20px;
  }
  h1 { color: #00ccff; font-size: 24px; margin-top: 10px; }
  section {
    background: rgba(255,255,255,0.1);
    border-radius: 15px;
    padding: 20px; margin: 20px;
  }
  button {
    background: #00ccff; border: none;
    color: #fff; padding: 10px 20px;
    border-radius: 10px; margin: 5px;
    cursor: pointer; font-weight: bold;
  }
  button:hover { background: #0099cc; }
  pre {
    background: rgba(0,0,0,0.4);
    padding: 10px; border-radius: 10px;
    text-align: left; overflow-x: auto;
    font-size: 12px;
  }
  footer {
    margin-top: 30px; font-size: 12px;
    background: rgba(0,0,0,0.5);
    padding: 10px;
  }
</style>
</head>
<body>

<header>
  <img src="Sureway-logo.png" alt="Sureway Logo">
  <h1>Sureway MeMart Africa Escrow Demo</h1>
  <p>Blockchain-powered logistics & escrow (Stacks Testnet)</p>
</header>

<section>
  <h3>Clarity Smart Contract (Embedded)</h3>
  <pre>(define-data-var deposits (map principal uint))
(define-public (deposit (receiver principal) (amount uint))
  (begin
    (map-set deposits {sender: tx-sender} amount)
    (print {action: "deposit", from: tx-sender, to: receiver, amount: amount})
    (ok true)))
(define-public (confirm-delivery)
  (begin
    (print {action: "confirm-delivery", sender: tx-sender})
    (ok true)))
(define-public (refund)
  (begin
    (print {action: "refund", sender: tx-sender})
    (ok true)))</pre>

  <p><b>Seller:</b> ST2W71F29DDHZRCAT6FTWQ7N5HA44X6RG1MY8QRSC</p>
  <p><b>Amount:</b> 200 STX</p>
  <div>
    <button id="connectWallet">üîó Connect Leather Wallet</button>
    <button id="deposit">üí∞ Deposit 200 STX</button>
    <button id="confirm">‚úÖ Confirm Delivery</button>
    <button id="refund">‚Ü©Ô∏è Refund</button>
  </div>
</section>

<section>
  <h3>üîç Live Blockchain Feed</h3>
  <pre id="feed">‚è≥ Waiting for blockchain activity...</pre>
</section>

<footer>
  ¬© 2025 Sureway Integrated Technology Solutions Limited RC 8481374<br>
  Abdulazeez Yusuf ‚Äî Founder & CEO<br>
  Microsoft Build 2025 | Microsoft Ignite 2025 | 3MTT Cohort 3 Fellow (No-Code Azure ML)<br>
  WEF SDIM25 | WEF Insight 25 | WEF Cities of Mayors 25 | WEF SME Candidate 25
</footer>

<script>
const { AppConfig, UserSession, showConnect } = window.StacksConnect;
const { openContractCall } = window.StacksTransactions;
const { StacksTestnet } = window.StacksNetwork;

const appConfig = new AppConfig(['store_write', 'publish_data']);
const userSession = new UserSession({ appConfig });
const network = new StacksTestnet();

const contractAddress = "ST2W71F29DDHZRCAT6FTWQ7N5HA44X6RG1MY8QRSC";
const contractName = "sureway-escrow";
const feed = document.getElementById("feed");

function logFeed(msg) {
  const t = new Date().toLocaleTimeString();
  feed.innerHTML += `\n[${t}] ${msg}`;
  feed.scrollTop = feed.scrollHeight;
}

document.getElementById("connectWallet").onclick = () => {
  showConnect({
    userSession,
    appDetails: { name: "Sureway MeMart Africa", icon: "Sureway-logo.png" },
    onFinish: () => logFeed("‚úÖ Wallet connected successfully.")
  });
};

async function transact(fnName) {
  if (!userSession.isUserSignedIn()) {
    logFeed("‚ö†Ô∏è Please connect your wallet first!");
    return;
  }

  try {
    const txOptions = {
      contractAddress,
      contractName,
      functionName: fnName,
      functionArgs: [],
      network,
      appDetails: { name: "Sureway MeMart Africa" },
      onFinish: data => logFeed(`‚úÖ ${fnName} executed | TxID: ${data.txId}`),
      onCancel: () => logFeed("‚ùå Transaction cancelled.")
    };
    logFeed(`üöÄ Executing ${fnName}...`);
    await openContractCall(txOptions);
  } catch (err) {
    logFeed(`‚ùå Error: ${err.message}`);
  }
}

document.getElementById("deposit").onclick = () => transact("deposit");
document.getElementById("confirm").onclick = () => transact("confirm-delivery");
document.getElementById("refund").onclick = () => transact("refund");
</script>

</body>
</html>

