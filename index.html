
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sureway MeMart Africa</title>
<style>
  body { margin:0; font-family:sans-serif; background:#0b3d0b; color:#ffd700; }
  header { background:#004d00; padding:1rem; display:flex; align-items:center; }
  header img { height:50px; margin-right:1rem; }
  header h1 { margin:0; font-size:1.5rem; }
  .dashboard { padding:1rem; display:grid; grid-template-columns:1fr 1fr 1fr; gap:1rem; }
  .card { background:#006600; padding:1rem; border-radius:10px; color:#fff; }
  button { background:#ffd700; color:#004d00; border:none; padding:0.5rem 1rem; border-radius:5px; cursor:pointer; }
  #splash-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:#004d00; display:flex; justify-content:center; align-items:center; z-index:1000; color:#ffd700; font-size:2rem; }
  .fade-out { animation: fadeOut 1s forwards; }
  @keyframes fadeOut { to { opacity:0; visibility:hidden; } }
</style>
</head>
<body>

<!-- Splash overlay -->
<div id="splash-overlay">Sureway MeMart Africa</div>

<header>
  <img src="sureway-logo.png" alt="Logo">
  <h1>Sureway MeMart Africa</h1>
</header>

<div class="dashboard">
  <div class="card">
    <h2>Wallet</h2>
    <button id="connect-wallet">Connect Leather Wallet</button>
    <p id="wallet-address"></p>
    <p>STX Balance: <span id="wallet-balance">0</span></p>
  </div>

  <div class="card">
    <h2>Escrow</h2>
    <input type="number" id="escrow-id" placeholder="Escrow ID"><br><br>
    <input type="text" id="escrow-seller" placeholder="Seller Principal"><br><br>
    <input type="text" id="escrow-arbiter" placeholder="Arbiter Principal"><br><br>
    <input type="number" id="escrow-amount" placeholder="Amount (microSTX)"><br><br>
    <button id="create-escrow">Create Escrow</button>
    <button id="release-funds">Release Funds</button>
    <button id="raise-dispute">Raise Dispute</button>
    <button id="resolve-dispute">Resolve Dispute</button>
  </div>

  <div class="card">
    <h2>Points & Ratings</h2>
    <p>Merchant Points: <span id="merchant-points">0</span></p>
    <p>Buyer Points: <span id="buyer-points">0</span></p>
    <input type="number" id="rate-escrow-id" placeholder="Escrow ID"><br>
    <input type="text" id="rate-counterparty" placeholder="Counterparty Principal"><br>
    <input type="number" id="rate-score" placeholder="Rate 1-5"><br>
    <button id="submit-rating">Submit Rating</button>
    <p>Average Rating: <span id="avg-rating">0</span></p>
  </div>

  <div class="card">
    <h2>Sponsor Bounty</h2>
    <input type="number" id="bounty-id" placeholder="Bounty ID"><br>
    <input type="number" id="bounty-minpoints" placeholder="Min Points"><br>
    <input type="number" id="bounty-reward" placeholder="Reward (microSTX)"><br>
    <button id="create-bounty">Create Bounty</button>
    <button id="claim-bounty">Claim Bounty</button>
  </div>
</div>

<script type="module">
import { AppConfig, UserSession, showConnect } from "https://cdn.jsdelivr.net/npm/@stacks/transactions@2.5.0/dist/index.js";

const appConfig = new AppConfig(['store_write','publish_data']);
const userSession = new UserSession({ appConfig });

const CONTRACT_ADDRESS = "ST3XE74DQ4BY1W6WJBTX32G8KRCZDD2MJHCQ4Q7WA";
const CONTRACT_NAME = "memart-escrow";

function sleep(ms){ return new Promise(resolve=>setTimeout(resolve,ms)); }

// Splash auto-close
window.addEventListener('load', async()=>{
  await sleep(5000);
  document.getElementById('splash-overlay').classList.add('fade-out');
});

document.getElementById('connect-wallet').addEventListener('click', async ()=>{
  await showConnect({ appDetails: { name: "Sureway MeMart Africa" } });
  if(userSession.isUserSignedIn()){
    const userData = userSession.loadUserData();
    document.getElementById('wallet-address').textContent = userData.profile.stxAddress.testnet;
    document.getElementById('wallet-balance').textContent = "Fetching...";
  }
});

// Placeholder functions (link to Clarity contract)
document.getElementById('create-escrow').addEventListener('click', async ()=>{ alert("Create Escrow + auto points."); });
document.getElementById('release-funds').addEventListener('click', async ()=>{ alert("Release funds + auto reward."); });
document.getElementById('raise-dispute').addEventListener('click', async ()=>{ alert("Dispute raised."); });
document.getElementById('resolve-dispute').addEventListener('click', async ()=>{ alert("Dispute resolved."); });
document.getElementById('submit-rating').addEventListener('click', async ()=>{ alert("Rating submitted."); });
document.getElementById('create-bounty').addEventListener('click', async ()=>{ alert("Sponsor bounty created."); });
document.getElementById('claim-bounty').addEventListener('click', async ()=>{ alert("Bounty claimed."); });
</script>

<!--
=====================================================
CLARITY CONTRACT: memart-escrow.clar
Sureway MeMart Africa â€” Escrow + Loyalty (merchant & buyer) + Levels + Ratings + Sponsor Bounties
=====================================================

;; memart-escrow.clar
(define-constant ERR-ESCROW-EXISTS u100)
(define-constant ERR-ESCROW-NOT-FOUND u101)
(define-constant ERR-NOT-AUTHORIZED u102)
(define-constant ERR-INVALID-STATE u103)
(define-constant ERR-TRANSFER-FAILED u104)
(define-constant ERR-BOUNTY-EXISTS u110)
(define-constant ERR-BOUNTY-NOT-FOUND u111)
(define-constant ERR-BOUNTY-CLAIMED u112)
(define-constant ERR-INSUFFICIENT-POINTS u113)
(define-constant ERR-RATING-INVALID u120)
(define-constant ERR-RATING-DUPLICATE u121)
(define-constant ERR-RATING-NOT-PERMITTED u122)

(define-constant STATE_OPEN u0)
(define-constant STATE_RELEASED u1)
(define-constant STATE_DISPUTED u2)
(define-constant STATE_REFUNDED u3)
(define-constant STATE_RESOLVED u4)

;; Escrow map
(define-map escrows
  { escrow-id: uint }
  { buyer: principal, seller: principal, arbiter: principal, amount: uint, state: uint })

;; Points
(define-map merchant-points { merchant: principal } { points: uint })
(define-map buyer-points { buyer: principal } { points: uint })

;; Bounties
(define-map bounties
  { bounty-id: uint }
  { sponsor: principal, reward: uint, min-points: uint, claimed: bool, claimer: (optional principal) })

;; Ratings
(define-map ratings { escrow-id: uint, rater: principal, ratee: principal } { score: uint, timestamp: uint })
(define-map average-rating { user: principal } { total-score: uint, ratings-count: uint })

(define-data-var admin principal tx-sender)
(define-data-var swt-contract (optional principal) none)

;; PRIVATE HELPERS
(define-private (add-merchant-points (merchant principal) (pts uint)) ...)
(define-private (add-buyer-points (buyer principal) (pts uint)) ...)
(define-private (update-average-rating (ratee principal) (score uint)) ...)

;; PUBLIC FUNCTIONS: create-escrow, release-funds, raise-dispute, resolve-dispute, admin-refund
;; Bounty: create-bounty, claim-bounty
;; Rating: submit-rating
=====================================================
-->
</body>
</html>
